#!/bin/bash
declare -a PODRUN_ARGS
if [ -e ~/dotfiles ]; then
    PODRUN_ARGS+=(-v ~/dotfiles:/opt-3/bjodah-dotfiles)
fi
if [ -e ~/doc/it/apei-nycklar ]; then
    PODRUN_ARGS+=(-v ~/doc/it/apei-nycklar:/root/doc/it/apei-nycklar)
fi
if [ -e ~/.bash_history ]; then
    PODRUN_ARGS+=(-v ~/.bash_history:/root/.bash_history)
fi
if [ -e $(dirname $0)/bjodah-sandbox.tmux ]; then
    PODRUN_ARGS+=(-v $(dirname $0)/bjodah-sandbox.tmux:/root/.tmux.conf)
fi
main() {
    podrun \
        --cap-add=SYS_PTRACE \
        --device /dev/fuse \
        --cap-add SYS_ADMIN \
        --name bjodah-sandbox-$(basename "$PWD") \
        --image bjodah/triceratops-6:23 \
        ${PODRUN_ARGS[@]} \
        -v $(dirname $0)/bjodah-sandbox.rc:/opt/bjodah-sandbox.rc \
        "$@" \
            -- \
            bash -xc "\"echo -e '. /opt-3/cpython-v3.*-apt-deb/bin/activate\nexport PYTHONPATH=$(pwd)'>>/root/.bashrc\
                        ; bash -l /opt/bjodah-sandbox.rc\""  # that was easy...
}
{
    main "$@"
    exit $?
}
