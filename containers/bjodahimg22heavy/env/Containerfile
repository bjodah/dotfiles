# -*- mode: dockerfile -*-
FROM bjodah/bjodahimg22dot:22.6.a.1.1

MAINTAINER Bj√∂rn Dahlgren <bjodah@DELETEMEgmail.com>

COPY 10100-setup_ubuntu_packages.sh /opt/

RUN apt-get update && \
    /opt/10100-setup_ubuntu_packages.sh && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*

    # && \
    # updatedb

COPY 15000-pip-install.sh /opt/

RUN env CC=gcc-12 CXX=g++-12 /opt/15000-pip-install.sh && \
    rm -rf ~/.cache/pip

COPY 25000-install-pypy.sh /opt/

RUN env CC=gcc-12 CXX=g++-12 /opt/25000-install-pypy.sh && \
    rm -rf ~/.cache/pip


COPY 67000-rust.sh /opt/

RUN \
        mkdir /opt/cargo /opt/rustup && \
        CARGO_HOME=/opt/cargo PATH="$CARGO_HOME/bin:$PATH" RUSTUP_HOME=/opt/rustup /opt/67000-rust.sh

RUN env CC=gcc-12 CXX=g++-12 bash -c "source /opt/cargo/env; rustup default stable; cargo install difftastic"

COPY 75000-cpython.sh /opt/

RUN env CPYTHON_VERSION=3.11 /opt/75000-cpython.sh

COPY 75050-scipy.sh /opt/

RUN sed -i.bak 's/ scipy / /g' /opt/150-pip-install.sh \
    && env CC=gcc-12 CXX=g++-12 PYTHON=/opt/cpython-3.11.0rc1-release/bin/python3 /opt/75050-scipy.sh

RUN env CC=gcc-12 CXX=g++-12 PYTHON=/opt/cpython-3.11.0rc1-debug/bin/python3   /opt/75050-scipy.sh

RUN /opt/cpython-3.11.0rc1-release/bin/python3 -c "import scipy; print(scipy.__version__)" \
    && env YARL_NO_EXTENSIONS=1 /opt/cpython-3.11.0rc1-release/bin/python3 -m pip install https://github.com/aio-libs/yarl/archive/master.tar.gz \
    && env FROZENLIST_NO_EXTENSIONS=1 /opt/cpython-3.11.0rc1-release/bin/python3 -m pip install https://github.com/aio-libs/frozenlist/archive/master.tar.gz \
    && env AIOHTTP_NO_EXTENSIONS=1 /opt/cpython-3.11.0rc1-release/bin/python3 -m pip install https://github.com/aio-libs/aiohttp/archive/master.tar.gz \
    && env CC=gcc-12 CXX=g++-12 /opt/cpython-3.11.0rc1-release/bin/python3 -m pip install black ase asv check-manifest conan dufte epc flake8 holoviews[recommended] ipykernel ipython ipywidgets ipympl isort joblib jupyter matplotlib mpld3 mogli mypy nbconvert nbsphinx nbstripout "notebook<7" networkx Nikola[extras] numericalunits numpydoc param periodictable debugpy pulp pudb pycparser pycparser-fake-libc pygraphviz pylatex pytest-black pytest-cov pytest-docstyle pytest-flake8 pytest-flakes pytest-pep8 pytest-pudb pytest-xdist quantities rstcheck SciencePlots setuptools_scm sphinx sphinx_rtd_theme sympy pyfma termplotlib toolz virtualenv websockets xarray yq \
    && rm -r ~/.cache/pip

RUN apt-get update \
    && apt-get --assume-yes --no-install-recommends install \
        libmpc-dev \
    && apt-get clean \
    && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*


# scikit-image scikit-optimize statsmodels "numba<0.56"

# env CC=gcc-12 CXX=g++-12 PYTHON=/opt/cpython-3.11.0rc1-debug/bin/python3 /opt/150-pip-install.sh \
# && /opt/cpython-3.11.0rc1-debug/bin/python3 -m pip install debugpy \



# RUN git clone https://github.com/mattgodbolt/seasocks.git /build/seasocks && \
#     cmake -S /build/seasocks -B /build/seasocks/build -DCMAKE_BUILD_TYPE=Debug -DCMAKE_INSTALL_PREFIX=/opt/seasocks -DCMAKE_EXPORT_COMPILE_COMMANDS=ON && \
#     cmake --build /build/seasocks/build && \
#     cmake --install /build/seasocks/build && \
#     ln -s /build/seasocks/build/compile_commands.json /opt/seasocks/



# https://gitlab.inria.fr/gappa/gappa
# https://www.sollya.org/
# (https://gitlab.com/flopoco/flopoco)

